
/*! FitMe - v0.1 - 2014-06-12
* https://github.com/lmeurs/fitme
* Copyright (c) 2014 Laurens Meurs, wiedes.nl; Licensed MIT */
;var FitMe={fillMode:"cover",doProcessSettingsBeforeUpdate:false,doUpdateOnWindowResize:true,initialize:function(){this.initializeVariables();if(this.checkCssProperties)this.checkCssProperties();if(this.bindElementEvents)this.bindElementEvents();if(this.bindWindowEvents)this.bindWindowEvents();this.update(true);this.$child.add(this.$parent).data("fit-me-instance",this).addClass("fit-me-processed")},initializeVariables:function(){this.$parent=this.getParent();this.id="fit-me-"+Date.now()+"-"+String(Math.random()).substr(2);this._doCalculateRatio=!this.ratio;this._lastDataAttributes={};this._updateEventCallbackTimeout=null},getParent:function(){return this.$child.parent()},checkCssProperties:function(){if(this.$child.css("display")=="inline")this.$child.css("display","block");if(this.$child.css("position")=="static")this.$child.css("position","relative");if(this.$parent.css("position")=="static")this.$parent.css("position","relative")},bindElementEvents:function(){this.$child.bind("fit-me-update",{fitMe:this},this.updateEventCallback);this.$parent.bind("fit-me-update."+this.id,{fitMe:this},this.updateEventCallback)},bindWindowEvents:function(){jQuery(window).bind("load."+this.id,{fitMe:this},this.updateEventCallback);if(this.doUpdateOnWindowResize){jQuery(window).bind("resize."+this.id,{fitMe:this,addTimeout:true},this.updateEventCallback)}},updateEventCallback:function(e){e.data.fitMe.update(true);if(e.data.addTimeout){clearTimeout(this._updateEventCallbackTimeout);this._updateEventCallbackTimeout=setTimeout(function(){e.data.fitMe.update(true)},100)}e.stopPropagation()},update:function(e){if(e||!this.ratio||this.doProcessSettingsBeforeUpdate){this.processSettings()}var t={};t.width=this.$parent.width();t.height=this.$parent.height();t.ratio=t.width/t.height;this.setChildDimensions(t)},processSettings:function(){if(this.readDataAttributes)this.readDataAttributes();if(this._doCalculateRatio&&this.calculateRatio)this.calculateRatio();if(this.checkSettings)this.checkSettings()},readDataAttributes:function(){var e=this.$child.data(),t,n;for(var t in e){if(t!="fitMeInstance"&&e[t]!==""&&e[t]!=this._lastDataAttributes[t]&&(n=t.match(/^fitMe(\w)(.*)/))){this.set(n[1].toLowerCase()+n[2],e[t])}}this._lastDataAttributes=$.extend({},e)},calculateRatio:function(e){if(this.$child.attr("width")&&this.$child.attr("height")){this.ratio=this.$child.attr("width")/this.$child.attr("height")}else{this.ratio=this.$child.width()/this.$child.height()}},checkSettings:function(e){this.ratio=$.isNumeric(this.ratio)?this.ratio:1;this.focalPointX=$.isNumeric(this.focalPointX)?this.focalPointX:.5;this.focalPointY=$.isNumeric(this.focalPointY)?this.focalPointY:.5},setChildDimensions:function(e){var t={},n=this.fillMode=="cover"&&this.ratio<e.ratio||this.fillMode!="cover"&&this.ratio>e.ratio;t.width=n?e.width:e.height*this.ratio;t.height=!n?e.height:e.width/this.ratio;t.left=n?0:(e.width-t.width)*this.focalPointX;t.top=!n?0:(e.height-t.height)*this.focalPointY;if(this.alterDimensions)this.alterDimensions(t,e);this.$child.css(t)},alterDimensions:function(e){},get:function(e){return this[e]||null},set:function(key,value){if(typeof value!==undefined)this[key]=value;else delete this[key];if(key=="ratio"){this.ratio=eval(this.ratio);this._doCalculateRatio=false}}};(function(e){e.fn.fitMe=function(t){return this.each(function(n,r){var i={$child:e(r)};e.extend(i,FitMe,t);i.initialize()})}})(jQuery);
